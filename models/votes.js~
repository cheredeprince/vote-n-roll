var Datastore = require('nedb'),
    db        = new Datastore({ filename: '../db/votes', autoload: true }),
    _         = require('lodash');

var candidats = require('./candidats');

// incrémente le nombre de vote d'une certaine liste de préférence de label
exports.add = function(labelsList,next){
  var candidatsLabels = candidats.labels(),
      interLabels = _.intersection(labelsList,candidatsLabels),
      voteLabel;

  //si tous les labels existent et qu'aucun n'est en double
  //et la liste contient tous les candidats.
  if(interLabels.length == candidatsLabels.length
     && labelsList.length == candidatsLabels.length){
    //construction du label de vote et inscription du nouveau vote.
    voteLabel = labelsList.join('-');
    db.update({vote:voteLabel},{$inc: {number: 1}},{upsert: true},function(err,a,upsert){
      if(err) return next(err);
      next(null,a,upsert);
    })
  }else
    return next(true);
}




exports.show = function(next){
  db.find({},function(err,docs){
    return next(docs);
  })
}








