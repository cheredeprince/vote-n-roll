!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("./scrutin"),e=a("./data"),f=a("./display");d3.json("/vote/json/"+Election.id,function(a){for(var a=a,b=Election.Candidats.labels,c=document.getElementsByClassName("card"),g=0;g<c.length;g++)c[g].onclick=function(){for(var a=[],d=0;d<c.length;d++){var e=c[d].getElementsByTagName("input")[0];e.checked&&a.push(e.getAttribute("data-label"))}a.length>2&&(b=a,h())};var h=function(){var c={};for(var g in a){var h=_.cloneDeep(a[g]);c[g]=d.filter[g](h,b)}var i={};for(var j in Election.scrutins){var k=Election.scrutins[j],g=k.voteMode;i[j]=d[k.mkRes](c[g])}var l=function(){var a,b=document.getElementsByClassName("scr-chart");for(a=0;a<b.length;a++){var c=b[a].getElementsByTagName("svg")[0];c&&c.parentNode.removeChild(c)}f.changeSize(),f.setColors(_.reduce(Election.Candidats,function(a,b,c){return a[b.name]=b.color,a},{})),f.setConf("voteMode",VoteMode),f.setConf("cand",Election.Candidats);var d=_.map(Election.scrutins,function(a,b){var c=i[b].ranked;return c=_.mapKeys(c,(a,b)=>Election.Candidats[b].name),c.category=a.name,c});f.score(d,"total");for(var g in Election.scrutins){(0,f[Election.scrutins[g].display])((0,e[Election.scrutins[g].getData])(i[g],Election.Candidats),g)}};window.addEventListener("resize",l),l()};h()})},{"./data":2,"./display":3,"./scrutin":4}],2:[function(a,b,c){c.majData=function(a,b){var c={};c.times=[],c.links=[];var d={},e=-1;return c.times=_.map(a.scores,(a,c)=>_.map(a,(a,f)=>{e++;d[f+"-"+c]=e;return{id:e,nodeName:b[f].name,image:b[f].image,nodeValue:a}})),c.links=_.flatMap(a.flux,(a,b)=>_.map(a,(a,c)=>{var e=c.split("-");return{source:d[e[0]+"-"+b],target:d[e[1]+"-"+(b+1)],value:a}})),c},c.hist=function(a,b){return _.map(a.scores[0],function(a,c){return{label:b[c].name,image:b[c].image,value:a}})},c.cumulHist=function(a){var b=_.map(_.sortBy(_.map(a.ranked,function(a,b){return{cand:b,value:a}}),["value"]),a=>a.cand);return _.map(b,function(b){var c=_.reduce(a.sortedMention,function(c,d){return c[d]=a.scores[0][b][d]||0,c},{});return c.State=b,c})}},{}],3:[function(a,b,c){var i,d=document,e=d.getElementById("main"),f=e.clientWidth,g={top:30,left:20,bottom:40,right:20},h=600,j={},k=function(a){i=a},l=function(a,b){j[a]=b},m=function(){f=e.clientWidth,f<h?(g.right=0,g.left=0):(g.right=20,g.left=20)},n=function(a,b){a=a.sort(function(a,b){return b.value-a.value});var a,p,q,r,t,c=10,d=4,e=.4,j=f,k=Math.max(400,f/2),l=(k-c-g.top-g.bottom)*e/a.length,m=(k-c-g.right-g.left)*(1-e)/a.length,n=l+2*m*.4,o=4,u=0;max=d3.max(a,function(a){return a.value}),q=d3.select(".scr-chart-"+b).append("svg").attr("width",j).attr("height",k),p=q.selectAll("g").data(a).enter().append("g"),p.attr("class","bar").attr("cx",0).attr("transform",function(a,b){return"translate("+g.left+","+(b*(l+m)+m)+")"});var v=p.append("g");v.append("text").attr("class","label").attr("y",l/2).attr("dy",".35em").text(function(a){return f<h?s(a.label):a.label}).attr("x",n+o),v.append("svg:image").attr("transform","translate(0,"+(-n+l)/2+")").attr("width",n).attr("height",n).attr("xlink:href",function(a){return a.image}),v.each(function(){u=Math.ceil(Math.max(u,this.getBBox().width))}),r=d3.scale.linear().domain([0,max]).range([0,j-g.left-g.right-u]),t=d3.svg.axis().scale(r).tickSize(-k+g.top+g.bottom+c).orient("bottom"),p.append("rect").attr("transform","translate("+u+", 0)").attr("height",l).attr("width",function(a){return r(a.value)}).attr("fill",function(a){return i[a.label]}),p.append("text").attr("class","value").attr("y",l/2).attr("dx",-d+u).attr("dy",".35em").attr("text-anchor","end").text(function(a){return a.value}).attr("x",function(a){var b=this.getBBox().width;return Math.max(b+d,r(a.value))}),f>=h&&q.insert("g",":first-child").attr("class","axisHorizontal").attr("transform","translate("+(g.left+u)+","+(k-c-g.top)+")").call(t)},o=function(a,b){var d=(d3.select("body").append("div").attr("class","toolTip"),f-g.left-g.right),e=500*f/960-g.top-g.bottom,j=18;f<h&&(j=9);var k=d3.scale.ordinal().rangeRoundBands([0,d],.1),l=d3.scale.ordinal(),m=d3.scale.linear().range([e,0]),n=d3.svg.axis().scale(k).orient("bottom"),o=d3.select(".scr-chart-"+b).append("svg").attr("width",d+g.left+g.right).attr("height",e+g.top+g.bottom),o=o.append("g").attr("transform","translate("+g.left+","+g.top+")"),p=d3.keys(a[0]).filter(function(a){return"category"!==a});a.forEach(function(a){a.ages=p.map(function(b){return{name:b,value:+a[b]}})}),k.domain(a.map(function(a){return a.category})),l.domain(p).rangeRoundBands([0,k.rangeBand()]),m.domain([1+d3.max(a,function(a){return d3.max(a.ages,function(a){return a.value})}),1]),o.append("g").attr("class","x axis").attr("transform","translate(0,"+e+")").call(n).selectAll("text").call(r,k.rangeBand());var q=o.selectAll(".state").data(a).enter().append("g").attr("class","state").attr("transform",function(a){return"translate("+k(a.category)+",0)"}),t=q.selectAll("rect").data(function(a){return a.ages}).enter().append("g").attr("transform",function(a){return"translate("+l(a.name)+","+m(a.value)+")"});t.append("rect").attr("width",l.rangeBand()).attr("height",function(a){return e-m(a.value)}).style("fill",function(a){return i[a.name]}),t.append("text").attr("class","value").attr("y",4).attr("dy",".75em").attr("text-anchor","middle").attr("x",l.rangeBand()/2).text(function(a){return""+a.value});var u=o.selectAll(".legend").data(p.slice().reverse()).enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(0,"+b*(j+2)+")"});u.append("rect").attr("x",d-j+4).attr("width",j).attr("height",j).style("fill",function(a){return i[a]}),u.append("text").attr("x",d-j).attr("y",j/2).attr("dy",".35em").style("text-anchor","end").text(function(a){return s(a)})},p=function(a,b){console.log(a);var c=f-g.left-g.right,d=500*f/960-g.top-g.bottom,e=40,i=20,k=.15,l=18,m=d3.format(".01%");f<h&&(l=9);for(var n=d3.select(".scr-chart-"+b).append("svg").attr("width",c+g.left+g.right).attr("height",d+g.top+g.bottom).append("g").attr("transform","translate("+g.left+","+g.top+")"),o=j.voteMode.jug.sortedMention.reverse(),p=0,q=0;q<o.length;q++)p+=a[0][o[q]];var s=d3.layout.stack()(o.map(function(b,c){var d=a.map(function(a,c){return{x:j.cand[a.State].name,y:a[b]/p}});return d.mention=b,d})),t=d3.scale.ordinal().domain(s[0].map(function(a){return a.x})).rangeRoundBands([i,c-e],k),u=d3.scale.linear().domain([0,d3.max(s,function(a){return d3.max(a,function(a){return a.y0+a.y})})]).range([d,0]),v=n.selectAll("g.cost").data(s).enter().append("g").attr("class","cost").style("fill",function(a){return j.voteMode.jug.colorMention[a.mention]}),x=(v.selectAll("rect").data(function(a){return a}).enter().append("rect").attr("x",function(a){return t(a.x)}).attr("y",function(a){return u(a.y0+a.y)}).attr("height",function(a){return u(a.y0)-u(a.y0+a.y)}).attr("width",t.rangeBand()).on("mouseover",function(){B.style("display",null)}).on("mouseout",function(){B.style("display","none")}).on("mousemove",function(a){var b=d3.mouse(this)[0]-15,c=d3.mouse(this)[1]-25;B.attr("transform","translate("+b+","+c+")"),B.select("text").text(m(a.y))}),d3.svg.axis().scale(u).orient("left").ticks(1).tickSize(-c+e+i+2*k*t.rangeBand()).tickFormat(d3.format(".0%"))),y=d3.svg.axis().scale(t).orient("bottom");n.append("g").attr("class","y axis").attr("transform","translate("+(i+k*t.rangeBand())+",0)").call(x);var z=n.append("g").attr("transform","translate("+(i+k*t.rangeBand())+","+d/2+")").attr("class","y majority-axis");z.append("line").attr("x2",c-e-i-2*k*t.rangeBand()).attr("y2",0),z.append("text").style("text-anchor","end").attr("dy",".32em").attr("x","-3").text("50%"),n.append("g").attr("class","x axis").attr("transform","translate(0,"+d+")").call(y).selectAll("text").call(r,t.rangeBand());var A=n.selectAll(".legend").data(o.slice().reverse()).enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(0,"+b*(l+2)+")"});A.append("rect").attr("x",c-l+4).attr("width",l).attr("height",l).style("fill",function(a){return j.voteMode.jug.colorMention[a]}),A.append("text").attr("x",c-l).attr("y",l/2).attr("dy",".35em").style("text-anchor","end").text(function(a){return j.voteMode.jug.nameMention[a]});var B=n.append("g").attr("class","tooltip").style("display","none");B.append("rect").attr("width",30).attr("height",20).attr("fill","white").style("opacity",.5),B.append("text").attr("x",15).attr("dy","1.2em").style("text-anchor","middle").attr("font-size","12px").attr("font-weight","bold")},q=function(a,b){function u(b){var d=a.slice(0,++t),e=s.selectAll("g.time").data(d).enter().append("svg:g").attr("class","time").attr("transform",function(a,b){return"translate("+(o(b)-o(0))+",0)"}),f=e.selectAll("g.node").data(function(a){return a}).enter().append("svg:g").attr("class","node").on("mouseout",function(a){h.style("display","none")}),g=f.append("svg:g").on("mousemove",function(a){h.style("left",d3.event.pageX+10+"px"),h.style("top",d3.event.pageY-25+"px"),h.style("display","inline-block"),h.html(a.nodeName+"<br>"+a.nodeValue+" voix")});g.append("svg:rect").attr("y",function(a,b){return p(a.offsetValue)+b*n}).attr("width",o.rangeBand()).attr("height",function(a){return p(a.nodeValue)}).attr("fill",function(a){return i[a.nodeName]}),g.append("svg:image").attr("y",function(a,b){return p(a.offsetValue)+b*n}).attr("width",function(a){return Math.min(o.rangeBand(),p(a.nodeValue))}).attr("height",function(a){return Math.min(o.rangeBand(),p(a.nodeValue))}).attr("transform",function(a){return"translate("+(o.rangeBand()-Math.min(o.rangeBand(),p(a.nodeValue)))/2+","+(p(a.nodeValue)-Math.min(o.rangeBand(),p(a.nodeValue)))/2+")"}).attr("xlink:href",function(a){return a.image});var j=function(a){return function(b){var d=c[b.source],e=c[b.target],f=o(0),g=o.rangeBand()+f,h=o.rangeBand()-g,i=p(d.offsetValue)+d.order*n+p(b.outOffset)+p(b.value)/2,j=p(e.offsetValue)+e.order*n+p(b.inOffset)+p(b.value)/2;return q(a?[[h,i],[h,i],[h,i],[h,i]]:[[h,i],[h+f/2,i],[h+f/2,j],[0,j]])}};f.selectAll("path.link").data(function(a){return a.incoming||[]}).enter().append("svg:path").attr("class","link").style("stroke-width",function(a){return p(a.value)}).style("stroke",function(a){return a.color}).attr("d",j(!0)).on("mouseover",function(a){d3.select(this).attr("class","link on")}).on("mouseout",function(){d3.select(this).attr("class","link")}).on("mousemove",function(a){h.style("left",d3.event.pageX+10+"px"),h.style("top",d3.event.pageY-25+"px"),h.style("display","inline-block"),h.html("transfert de "+a.value+" voix")}).transition().duration(m).attr("d",j())}function v(){t<a.length&&(u(),window.setTimeout(v,m))}var c=function(){var b={};return a.times.forEach(function(a){a.forEach(function(a){b[a.id]=a,a.links=[],a.incoming=[],a.nodeValue=a.nodeValue||0})}),b}();a.links.forEach(function(a){c[a.source].links.push(a),c[a.target].incoming.push(a)}),a.times.forEach(function(a){var b=0;a.sort(function(a,b){return d3.descending(a.nodeValue,b.nodeValue)}),a.forEach(function(a,c){a.order=c,a.offsetValue=b,b+=a.nodeValue;var d;a.links&&(d=0,a.links.sort(function(a,b){return d3.descending(a.value,b.value)}),a.links.forEach(function(b){b.outOffset=d,d+=b.value,b.color=i[a.nodeName]})),a.incoming&&(d=0,a.incoming.sort(function(a,b){return d3.descending(a.value,b.value)}),a.incoming.forEach(function(a){a.inOffset=d,d+=a.value}))})}),a=a.times;var d=d3.max(a,function(a){return a.length}),e=d3.max(a,function(a){return d3.sum(a,function(a){return a.nodeValue})}),h=d3.select("body").append("div").attr("class","toolTip"),j=f-g.right-g.left,k=Math.max(f/2,400)-g.bottom-g.top,l=.7,m=0,n=15,o=d3.scale.ordinal().domain(d3.range(a.length)).rangeBands([0,j+j/(a.length-1)],l),p=d3.scale.linear().domain([0,e]).range([0,k-n*d]),q=d3.svg.line().interpolate("basis"),r=d3.select(".scr-chart-"+b).append("svg:svg").attr("width",j+g.left+g.right).attr("height",k+g.top+g.bottom),s=r.append("g").attr("transform","translate("+g.left+","+g.top+")"),t=0;u(!0),v()},r=function(a,b){a.each(function(){for(var d,a=d3.select(this),c=a.text().split("").reverse(),e=[],f=0,g=1.1,h=a.attr("y"),i=parseFloat(a.attr("dy")),j=a.text(null).append("tspan").attr("x",0).attr("y",h).attr("dy",i+"em");d=c.pop();)e.push(d),j.text(e.join("")),j.node().getComputedTextLength()>b&&(e.pop(),j.text(e.join("")),e=[d],j=a.append("tspan").attr("x",0).attr("y",h).attr("dy",++f*g+i+"em").text(d))})},s=function(a){var b=a.split(" ");return b.splice(0,1)[0][0]+". "+b.join(" ")};c.changeSize=m,c.setColors=k,c.hist=n,c.stackedBar=p,c.score=o,c.maj=q,c.setConf=l},{}],4:[function(a,b,c){c.maj1Sct=function(a){return f(a,[1])},c.maj2Sct=function(a){return f(a,[2,1])},c.majnSct=function(a){var b=[];return 0!=a.length&&(b=_.range(a[0].prefList.length-1,0,-1)),f(a,b)},c.bordasSct=function(a){var b=_.reduce(_.flatMap(a,a=>_.map(a.prefList,(b,c)=>[b,(a.prefList.length-c)*a.number])),function(a,b){return a[b[0]]=(a[b[0]]||0)+b[1],a},{}),c=[];if(0!=a.length){var d=_.sortBy(a[0].prefList,a=>-b[a]);c=_.reduce(d,(a,b,c)=>{a[b]=c+1;return a},{})}return{ranked:c,scores:[b]}},c.condorcetSct=function(a){var b=_.flatMap(a,function(a){var b=a.prefList;return _.flatMap(b,(c,d)=>_.map(b.slice(d+1),b=>[c+"-"+b,a.number]))}),c=_.reduce(b,function(a,b){return a[b[0]]=(a[b[0]]||0)+b[1],a},{}),d=_.reduce(c,function(a,b,d){var e=d.split("-"),f=e[1]+"-"+e[0];return!c[f]||b>c[f]?a[e[0]]=(a[e[0]]||0)+1:a[e[0]]=a[e[0]]||0,a},{}),e=[];if(0!=a.length){var f=_.sortBy(a[0].prefList,a=>-d[a]);e=_.reduce(f,(a,b,c)=>{a[b]=c+1;return a},{})}return{ranked:e,scores:[d]}},c.filter={pref:function(a,b){return e(a,b).votes},jug:function(a,b){return _.map(a,function(a){return{number:a.number,candMention:_.pick(a.candMention,b)}})}},c.jugMaj=function(a){var b=a.length,c=["insuf","passa","quitg","good","veryg"],e={},f={},g=_.reduce(a,function(a,b){return _.forEach(b.candMention,function(d,e){if(a[e]){a[e][d]=(a[e][d]||0)+b.number;for(var g=0;g<=c.indexOf(d);g++)f[e][c[g]]=(f[e][c[g]]||0)+b.number}else{a[e]={},a[e][d]=b.number,f[e]={};for(var g=0;g<=c.indexOf(d);g++)f[e][c[g]]=b.number}}),a},{}),h=_.mapValues(f,function(a,d){for(var f=c.length-1;f>-1;f--){var g=c[f];if(a[g]>b/2)return e[d]=a[g],g}}),i=Object.keys(h).sort(function(a,b){var d=c.indexOf(h[a]),f=c.indexOf(h[b]);return d==f?0!=d?e[b]-e[a]:g[a][h[a]]-g[b][h[b]]:f-d});return{ranked:_.mapValues(h,function(a,b){return i.indexOf(b)+1}),scores:[g],cumulScore:f,majMention:h,sortedMention:["insuf","passa","quitg","good","veryg"]}};var d=function(a,b){var c=_.clone(a[0].prefList),d=_.reduce(c,(a,b)=>{a[b]=0;return a},{}),e=_.reduce(a,function(a,b){return a[b.prefList[0]]?a[b.prefList[0]]+=b.number:a[b.prefList[0]]=b.number,a},{});return e=_.defaults(e,d),{ranked:_.sortBy(c,a=>-e[a]).slice(0,b),scores:e}},e=function(a,b){var c=_.reduce(a,function(a,c){var d=c.prefList[0],e=_.intersection(c.prefList,b),f=e[0],g=e.join("-"),h=d+"-"+f;return a[0][g]?a[0][g].number+=c.number:a[0][g]={number:c.number,prefList:e},a[1][h]=(a[1][h]||0)+c.number,a},[{},{}]),d=c[0],e=c[1];return{votes:_.map(d,a=>a),flux:e}},f=function(a,b){var c=function(a,b,f,g){if(0==b.length)return{flux:g.slice(0,g.length-1),ranked:[],scores:f};var h=b.shift(),i=d(a,h),j=e(a,i.ranked);return f.push(i.scores),g.push(j.flux),c(j.votes,b,f,g)},f=0!=a.length?c(a,b,[],[]):{flux:[],ranked:[],scores:[]},g=_.map(f.scores,(a,b)=>_.mapValues(a,a=>Math.pow(10,b)*a)),h=_.reduce(_.flatMap(g,a=>_.toPairs(a)),function(a,b){return a[b[0]]=Math.max(a[b[0]]||0,b[1]),a},{});if(0!=a.length){var i=_.sortBy(a[0].prefList,a=>-h[a]);f.ranked=_.reduce(i,(a,b,c)=>{a[b]=c+1;return a},{})}return f}},{}]},{},[1]);